        <div class="container mt-4">
        <div class="page-header">
            <div>
                <h1 class="page-title">Lista de Países</h1>
                <div class="page-subtitle">Resumen de países cargados en la base de datos</div>
            </div>
            <div>
                <a id="addCountryBtn" href="/countries/new" class="btn btn-success">
                    <i class="fa fa-plus"></i>
                    Agregar país
                </a>
            </div>
        </div>
        
        <table id="countriesTable" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Capital</th>
                    <th>Población</th>
                    <th>Gini</th>
                    <th>Área</th>
                    <th>Código</th>
                    <th>Fronteras</th>
                    <th>Timezones</th>
                    <th>Creador</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <% if (countries && countries.length > 0) { %>
                    <% countries.forEach(country => { %>
                        <tr>
                            <td><%= country.name %></td>
                            <td><%= country.capital.join(', ') %></td>
                            <td><%= country.population?.toLocaleString() || 'N/A' %></td>
                            <td>
                                <% 
                                    let latestGini = null;
                                    let historyText = '';
                                    try {
                                        if (country.gini && Object.keys(country.gini).length) {
                                            const years = Object.keys(country.gini).sort();
                                            const y = years[years.length - 1];
                                            latestGini = Number(country.gini[y]);
                                            // construir historial legible
                                            historyText = years.map(yr => `${yr}: ${country.gini[yr]}`).join('\n');
                                        }
                                    } catch(e) { latestGini = null; historyText = ''; }
                                    const formattedGini = latestGini !== null && !Number.isNaN(latestGini) ? latestGini.toFixed(1) : '-';
                                %>
                                <span title="<%= historyText.replace(/\"/g, '&#34;') %>"><%= formattedGini %></span>
                            </td>
                            <td><%= country.area?.toLocaleString() || 'N/A' %> km²</td>
                            <td><%= country.abr %></td>
                            <td>
                                <% if (country.borders && country.borders.length > 0) { %>
                                    <% const borderNames = country.borders.map(code => codeToName[code] || code); %>
                                    <%= borderNames.join(', ') %>
                                <% } else { %>
                                    -
                                <% } %>
                            </td>
                            <td>
                                <% if (country.timezones && country.timezones.length > 0) { %>
                                    <ul class="mb-0 ps-3">
                                        <% country.timezones.forEach(tz => { %>
                                            <li><%= tz %></li>
                                        <% }) %>
                                    </ul>
                                <% } else { %>
                                    -
                                <% } %>
                            </td>
                            <td><%= country.creador || '-' %></td>
                            <td class="text-center">
                                <a href="/countries/edit/<%= country._id %>" title="Editar" class="action-icon me-2">
                                    <i class="fa fa-pen"></i>
                                </a>
                                <a href="javascript:void(0)" title="Eliminar" class="action-icon delete" onclick="deleteCountry('<%= country._id %>')">
                                    <i class="fa fa-trash"></i>
                                </a>
                            </td>
                        </tr>
                    <% }); %>
                <% } else { %>
                    <tr>
                        <td colspan="8" class="text-center">No hay países disponibles</td>
                    </tr>
                <% } %>
            </tbody>
        </table>
    </div>
    
    <script>
        $(document).ready(function() {
            $('#countriesTable').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                },
                pageLength: 10,
                responsive: true,
                order: [[0, 'asc']], // Ordenar por nombre
                columnDefs: [
                    { targets: [7], orderable: false } // La columna de acciones no se puede ordenar
                ]
            });
        });

        // Funciones para las acciones
        function editCountry(id) {
            // Redirigir a página de edición o abrir modal
            window.location.href = `/countries/edit/${id}`;
        }

        function deleteCountry(id) {
            if (confirm('¿Estás seguro de que quieres eliminar este país?')) {
                fetch(`/countries/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error al eliminar el país');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error al eliminar el país');
                });
            }
        }
    </script>