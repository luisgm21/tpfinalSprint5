<div class="container mt-4">
  <% if (typeof errors === 'undefined') { var errors = []; } %>
  <h1><%= country ? 'Editar país' : 'Agregar país' %></h1>

  <% if (Array.isArray(errors) && errors.length) { %>
    <div class="alert alert-danger">
      <ul class="mb-0">
        <% errors.forEach(err => { %>
          <li><strong><%= err.field %>:</strong> <%= err.message %></li>
        <% }) %>
      </ul>
    </div>
  <% } %>

  <form id="countryForm" method="post" action="<%= country ? ('/countries/' + country._id) : '/countries' %>">
    <div class="mb-3">
      <label for="name" class="form-label">Nombre (oficial)</label>
  <input type="text" id="name" name="name" class="form-control <%= errors.find(e=>e.field==='name') ? 'is-invalid' : '' %>" value="<%= country ? country.name : '' %>">
      <% if (errors.find(e=>e.field==='name')) { %>
        <div class="invalid-feedback"><%= errors.find(e=>e.field==='name').message %></div>
      <% } %>
    </div>

    <div class="mb-3">
      <label for="capital" class="form-label">Capital(es) (separadas por coma)</label>
  <input type="text" id="capital" name="capital" class="form-control <%= errors.find(e=>e.field==='capital') ? 'is-invalid' : '' %>" placeholder="Buenos Aires, La Plata" value="<%= country && country.capital ? country.capital.join(', ') : '' %>">
      <% if (errors.find(e=>e.field==='capital')) { %>
        <div class="invalid-feedback"><%= errors.find(e=>e.field==='capital').message %></div>
      <% } %>
    </div>

    <div class="mb-3">
      <label for="languages" class="form-label">Languages (formato: code:name por línea)</label>
  <textarea id="languages" name="languages" class="form-control <%= errors.find(e=>e.field==='languages') ? 'is-invalid' : '' %>" rows="3" placeholder="spa:Spanish\neng:English"><%= country && country.languages ? Array.from(country.languages).map(([k,v])=> `${k}:${v}`).join('\n') : '' %></textarea>
      <% if (errors.find(e=>e.field==='languages')) { %>
        <div class="invalid-feedback d-block"><%= errors.find(e=>e.field==='languages').message %></div>
      <% } %>
      <div class="form-text">Ejemplo: <code>spa:Spanish</code> en cada línea</div>
    </div>

    <div class="mb-3">
      <label for="borders" class="form-label">Fronteras (códigos, separadas por coma)</label>
  <input type="text" id="borders" name="borders" class="form-control <%= errors.find(e=>e.field==='borders') ? 'is-invalid' : '' %>" placeholder="BRA, CHL, URY" value="<%= country && country.borders ? country.borders.join(', ') : '' %>">
      <% if (errors.find(e=>e.field==='borders')) { %>
        <div class="invalid-feedback"><%= errors.find(e=>e.field==='borders').message %></div>
      <% } %>
    </div>

    <div class="row">
      <div class="col-md-4 mb-3">
        <label for="area" class="form-label">Área (km²)</label>
  <input type="number" id="area" name="area" class="form-control <%= errors.find(e=>e.field==='area') ? 'is-invalid' : '' %>" step="any" value="<%= country && country.area ? country.area : '' %>">
      <% if (errors.find(e=>e.field==='area')) { %>
        <div class="invalid-feedback"><%= errors.find(e=>e.field==='area').message %></div>
      <% } %>
      </div>
      <div class="col-md-4 mb-3">
        <label for="population" class="form-label">Población</label>
  <input type="number" id="population" name="population" class="form-control <%= errors.find(e=>e.field==='population') ? 'is-invalid' : '' %>" value="<%= country && country.population ? country.population : '' %>">
      <% if (errors.find(e=>e.field==='population')) { %>
        <div class="invalid-feedback"><%= errors.find(e=>e.field==='population').message %></div>
      <% } %>
      </div>
      <div class="col-md-4 mb-3">
        <label for="abr" class="form-label">Código (cca3)</label>
        <input type="text" id="abr" name="abr" class="form-control" maxlength="3" value="<%= country && country.abr ? country.abr : '' %>">
      </div>
    </div>

    <div class="mb-3">
      <label for="timezones" class="form-label">Timezones (separadas por coma)</label>
  <input type="text" id="timezones" name="timezones" class="form-control <%= errors.find(e=>e.field==='timezones') ? 'is-invalid' : '' %>" placeholder="UTC-03:00" value="<%= country && country.timezones ? country.timezones.join(', ') : '' %>">
      <% if (errors.find(e=>e.field==='timezones')) { %>
        <div class="invalid-feedback"><%= errors.find(e=>e.field==='timezones').message %></div>
      <% } %>
    </div>

    <div class="mb-3">
      <label for="gini" class="form-label">Gini (formato: year:value por línea)</label>
  <textarea id="gini" name="gini" class="form-control <%= errors.find(e=>e.field==='gini') ? 'is-invalid' : '' %>" rows="2" placeholder="2019:42.5\n2020:43.1"><%= country && country.gini ? Array.from(country.gini).map(([k,v])=> `${k}:${v}`).join('\n') : '' %></textarea>
      <% if (errors.find(e=>e.field==='gini')) { %>
        <div class="invalid-feedback d-block"><%= errors.find(e=>e.field==='gini').message %></div>
      <% } %>
      <div class="form-text">Ejemplo: <code>2019:42.5</code> por línea</div>
    </div>

    <div class="d-flex gap-2">
      <button type="submit" class="btn btn-primary">Guardar</button>
      <a href="/countries" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>
</div>

<!-- Validación removida del front: toda la lógica de parse/validación de languages y gini quedó en el backend -->
  <!-- Interactividad y validación cliente removidas; toda la validación ocurre en el backend -->
